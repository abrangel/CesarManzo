<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entorno de Estudio: Aspectos Éticos y Legales (Completo)</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ESTILO IDE PROFESIONAL (Visual Studio Code Dark) --- */
        :root {
            --bg-dark: #1e1e1e;
            --bg-sidebar: #252526;
            --bg-editor: #1e1e1e;
            --border: #3e3e42;
            --accent: #007acc;
            --text-main: #d4d4d4;
            --text-muted: #858585;
            --scroll-thumb: #424242;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: var(--bg-dark); 
            font-family: 'Roboto', sans-serif; 
            color: var(--text-main); 
            height: 100vh; 
            display: flex; 
            overflow: hidden; 
        }

        /* --- SIDEBAR DE NAVEGACIÓN --- */
        .sidebar { 
            width: 300px; 
            background: var(--bg-sidebar); 
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 15px;
            background: #2d2d2d;
            font-size: 0.75rem;
            font-weight: bold;
            letter-spacing: 1px;
            color: #fff;
            border-bottom: 1px solid var(--border);
            text-transform: uppercase;
        }

        .section-title {
            padding: 12px 20px;
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 10px;
        }

        .nav-item {
            padding: 8px 25px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #cccccc;
            display: flex; align-items: center; gap: 10px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        .nav-item:hover { background: #2a2d2e; color: #fff; }
        .nav-item.active { 
            background: #37373d; 
            color: #fff; 
            border-left-color: var(--accent); 
        }

        /* --- ÁREA DE TRABAJO --- */
        .workspace { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        
        /* TABS SUPERIORES */
        .tabs-bar {
            height: 35px; background: var(--bg-sidebar); 
            display: flex; border-bottom: 1px solid var(--border);
        }
        .tab {
            padding: 0 15px; display: flex; align-items: center; gap: 8px;
            font-size: 0.8rem; background: var(--bg-editor); color: #fff;
            border-top: 2px solid var(--accent); border-right: 1px solid var(--border);
        }

        /* SPLIT PANE */
        .split-container { flex: 1; display: flex; overflow: hidden; }

        /* PANEL IZQUIERDO: TEORÍA Y NOTAS (PDF) */
        .theory-view {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            border-right: 1px solid var(--border);
            background: #1e1e1e;
            font-size: 1rem;
            line-height: 1.7;
            color: #d4d4d4;
            max-width: 50%;
        }
        
        .theory-view h1 { font-size: 1.8rem; color: #fff; margin-bottom: 10px; }
        .theory-view h2 { font-size: 1.3rem; color: var(--accent); margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .theory-view h3 { font-size: 1.1rem; color: #dcdcaa; margin-top: 25px; margin-bottom: 10px; }
        .theory-view p { margin-bottom: 15px; text-align: justify; }
        .theory-view ul { margin-bottom: 15px; padding-left: 20px; }
        .theory-view li { margin-bottom: 8px; }
        
        .highlight-box {
            background: rgba(0, 122, 204, 0.1);
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin: 20px 0;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        /* PANEL DERECHO: SIMULADOR Y CÓDIGO */
        .sim-view {
            flex: 1;
            display: flex; flex-direction: column;
            background: #1e1e1e;
            min-width: 0;
        }

        .controls-toolbar {
            padding: 10px 15px;
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            display: flex; gap: 15px; align-items: center;
        }

        .code-editor {
            flex: 1;
            padding: 20px;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            overflow: auto;
            color: #d4d4d4;
            white-space: pre;
            line-height: 1.5;
        }

        .terminal-output {
            height: 150px;
            background: #111;
            border-top: 1px solid var(--border);
            padding: 15px;
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
            color: #cccccc;
            overflow-y: auto;
        }

        /* Syntax Colors */
        .kwd { color: #569cd6; font-weight: bold; } /* Keywords */
        .str { color: #ce9178; } /* Strings */
        .com { color: #6a9955; font-style: italic; } /* Comments */
        .cls { color: #4ec9b0; } /* Classes */
        .fn { color: #dcdcaa; } /* Functions */
        .num { color: #b5cea8; } /* Numbers */
        .var { color: #9cdcfe; } /* Variables */

        select {
            background: #3c3c3c; color: white; border: 1px solid #555;
            padding: 6px 10px; border-radius: 3px; outline: none;
        }

        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Botón de volver */
        .sidebar-footer {
            margin-top: auto;
            padding: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .back-button-elegant {
            width: 100%;
            padding: 12px;
            background: rgba(0, 122, 204, 0.2);
            border: 1px solid #007acc;
            color: #007acc;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        .back-button-elegant:hover {
            background: #007acc;
            color: white;
            box-shadow: 0 0 15px rgba(0, 122, 204, 0.5);
        }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-university"></i> Aspectos Legales y Bioetica
        </div>
        
        <div class="section-title">Temario Teórico (PDFs)</div>
        <div id="menu-theory"></div>

        <div class="section-title" style="margin-top:20px;">Casos Prácticos (Trabajos)</div>
        <div id="menu-practical"></div>
        <div class="sidebar-footer">
            <button onclick="window.close()" class="back-button-elegant">
                <i class="fas fa-arrow-left"></i> VOLVER
            </button>
        </div>
    </div>

    <div class="workspace">
        <div class="tabs-bar">
            <div class="tab">
                <i class="fas fa-file-alt" style="color:#e67e22;"></i> 
                <span id="tab-name">Introducción</span>
            </div>
            <div class="tab" style="background: transparent; border-top: none; opacity: 0.5;">
                <i class="fas fa-code" style="color:#569cd6;"></i> simulator.py
            </div>
        </div>

        <div class="split-container">
            
            <div class="theory-view" id="theory-content">
                <h1>Bienvenido a la Plataforma de Estudio</h1>
                <p>Esta herramienta integra los 5 temas teóricos del módulo de "Aspectos Éticos y Legales" con los 2 trabajos prácticos realizados.</p>
                <div class="highlight-box">
                    Selecciona un tema en el menú lateral para cargar el contenido detallado de los PDFs y acceder al simulador de código correspondiente.
                </div>
            </div>

            <div class="sim-view">
                <div class="controls-toolbar" id="controls-area">
                    <span style="font-size:0.8rem; color:#aaa;">Esperando selección...</span>
                </div>
                <div class="code-editor" id="code-editor">
<span class="com"># El código del simulador aparecerá aquí.</span>
<span class="com"># Selecciona un tema para ver la implementación técnica.</span>
                </div>
                <div class="terminal-output" id="console-output">
                    > System ready...
                </div>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // BASE DE DATOS EXTENSA (CONTENIDO REAL DE ESTUDIO)
        // =================================================================
        
        const theoryModules = [
            {
                id: "t1",
                title: "Tema 1: Privacidad de Datos",
                icon: "fa-user-shield",
                content: `
                    <h1>Tema 1: Privacidad de Datos de Pacientes</h1>
                    <p>En el contexto de la bioinformática clínica, la gestión de datos genómicos presenta desafíos únicos debido a la inmutabilidad y unicidad del ADN. Este tema cubre las definiciones legales críticas y las técnicas de protección.</p>
                    
                    <h2>1. Definiciones Clave del RGPD (Art. 4)</h2>
                    <ul>
                        <li><strong>Dato Personal:</strong> Toda información sobre una persona física identificada o identificable. En genómica, una secuencia de ADN es, por defecto, un dato personal pseudonimizado, ya que contiene información única capaz de re-identificar al sujeto.</li>
                        <li><strong>Datos de Categoría Especial (Art. 9):</strong> Se prohíbe el tratamiento de datos genéticos, biométricos y de salud, salvo excepciones explícitas (como el consentimiento explícito o el interés público esencial).</li>
                        <li><strong>Tratamiento:</strong> Cualquier operación realizada sobre datos personales (recogida, registro, organización, estructuración, conservación, adaptación, extracción, consulta, uso, etc.).</li>
                    </ul>

                    <h2>2. Pseudonimización vs. Anonimización</h2>
                    <p>Es la distinción más importante para el bioinformático. Según el Dictamen 05/2014 del Grupo de Trabajo del Artículo 29:</p>
                    <ul>
                        <li><strong>Pseudonimización (Reversible):</strong> El dato se separa de la identidad directa (nombre, DNI) mediante un código. Existe una "tabla de correspondencias" guardada de forma segura. El RGPD sigue aplicando, pero las medidas de seguridad se consideran reforzadas.</li>
                        <li><strong>Anonimización (Irreversible):</strong> El proceso de eliminar los identificadores de tal forma que el sujeto ya no sea identificable. Si se hace correctamente, el RGPD deja de aplicar. Sin embargo, en genómica, la anonimización total es difícil sin destruir la utilidad del dato (k-anonymity, l-diversity).</li>
                    </ul>

                    <div class="highlight-box">
                        <strong>Nota Importante:</strong> Los datos genéticos tienen un alto riesgo de re-identificación mediante ataques de inferencia o cruce con bases de datos genealógicas públicas.
                    </div>
                `,
                controls: [
                    {id: "tech", label: "Técnica de Protección", options: ["Dato en Claro (Raw)", "Pseudonimización (Hash)", "Anonimización (K-Anon)"]}
                ],
                generateCode: (val) => {
                    if (val.includes("Raw")) return `
<span class="com"># ESCENARIO 1: DATOS EN CLARO (ALTO RIESGO)</span>
<span class="com"># Almacenar datos así viola el principio de Integridad y Confidencialidad del RGPD.</span>

<span class="kwd">class</span> <span class="cls">PatientRecord</span>:
    <span class="kwd">def</span> <span class="fn">__init__</span>(<span class="var">self</span>, <span class="var">name</span>, <span class="var">dni</span>, <span class="var">sequence</span>):
        <span class="var">self</span>.name = <span class="str">"Juan Pérez"</span>  <span class="com"># Identificador Directo</span>
        <span class="var">self</span>.dni = <span class="str">"12345678Z"</span>    <span class="com"># Identificador Directo</span>
        <span class="var">self</span>.sequence = <span class="str">"ATCGGCTA..."</span> <span class="com"># Dato Sensible (Art 9)</span>
        
    <span class="kwd">def</span> <span class="fn">save_to_db</span>(<span class="var">self</span>):
        <span class="com"># Vulnerabilidad: Si se filtra la DB, la re-identificación es inmediata.</span>
        <span class="fn">db_insert</span>(<span class="var">self</span>.__dict__)

<span class="com"># ALERTA: Multas de hasta 20M EUR o 4% facturación global.</span>`;

                    if (val.includes("Hash")) return `
<span class="com"># ESCENARIO 2: PSEUDONIMIZACIÓN (ESTÁNDAR)</span>
<span class="com"># Separación lógica de la identidad. Art. 4(5) RGPD.</span>

<span class="kwd">import</span> hashlib
<span class="kwd">import</span> secrets

<span class="kwd">class</span> <span class="cls">Pseudonymizer</span>:
    <span class="kwd">def</span> <span class="fn">__init__</span>(<span class="var">self</span>):
        <span class="com"># La 'salt' debe guardarse en un Hardware Security Module (HSM)</span>
        <span class="var">self</span>._secret_salt = secrets.token_hex(16) 
    
    <span class="kwd">def</span> <span class="fn">generate_id</span>(<span class="var">self</span>, <span class="var">real_id</span>):
        <span class="com"># Hash determinista SHA-256 + Salt</span>
        <span class="var">data</span> = <span class="var">real_id</span> + <span class="var">self</span>._secret_salt
        <span class="kwd">return</span> hashlib.sha256(<span class="var">data</span>.encode()).hexdigest()

<span class="com"># Flujo de Trabajo:</span>
<span class="var">pseudo_engine</span> = <span class="cls">Pseudonymizer</span>()
<span class="var">patient_code</span> = <span class="var">pseudo_engine</span>.<span class="fn">generate_id</span>(<span class="str">"12345678Z"</span>)

<span class="var">clinical_record</span> = {
    <span class="str">"id"</span>: <span class="var">patient_code</span>,  <span class="com"># ej: 5e8848... (Opaco)</span>
    <span class="str">"phenotype"</span>: <span class="str">"Glioblastoma"</span>,
    <span class="str">"vcf_file"</span>: <span class="str">"/storage/5e8848/genome.vcf"</span>
}
<span class="com"># NOTA: Permite re-identificación SOLO al poseedor de la Salt.</span>`;

                    return `
<span class="com"># ESCENARIO 3: ANONIMIZACIÓN (K-ANONIMATO)</span>
<span class="com"># Técnica de Generalización para uso estadístico/secundario.</span>

<span class="kwd">import</span> pandas <span class="kwd">as</span> pd

<span class="kwd">def</span> <span class="fn">apply_k_anonymity</span>(<span class="var">df</span>, <span class="var">k</span>=5):
    <span class="com"># 1. Supresión: Eliminar columnas directas</span>
    <span class="var">df</span> = <span class="var">df</span>.drop(columns=[<span class="str">'nombre'</span>, <span class="str">'dni'</span>, <span class="str">'nhc'</span>])
    
    <span class="com"># 2. Generalización: Convertir edad exacta a rangos</span>
    <span class="var">df</span>[<span class="str">'edad'</span>] = <span class="var">df</span>[<span class="str">'edad'</span>].apply(<span class="kwd">lambda</span> x: <span class="fn">get_age_range</span>(x))
    
    <span class="com"># 3. Validación K: Asegurar que cada fila es indistinguible de al menos k-1 otras</span>
    <span class="var">group_counts</span> = <span class="var">df</span>.groupby([<span class="str">'edad'</span>, <span class="str">'sexo'</span>, <span class="str">'zip_code'</span>]).size()
    <span class="kwd">if</span> <span class="var">group_counts</span>.min() < <span class="var">k</span>:
        <span class="kwd">raise</span> <span class="cls">PrivacyRiskException</span>(<span class="str">"K-Anonymity not met"</span>)
    
    <span class="kwd">return</span> <span class="var">df</span>

<span class="com"># Resultado: Datos útiles para estadística poblacional, inútiles para diagnóstico individual.</span>`;
                }
            },
            {
                id: "t2",
                title: "Tema 2: Regulación Nacional e Int.",
                icon: "fa-gavel",
                content: `
                    <h1>Tema 2: Marco Regulatorio (Ámbito Sanitario)</h1>
                    <p>La investigación biomédica se rige por un complejo entramado de leyes que equilibran el avance científico con los derechos fundamentales.</p>

                    <h2>1. Jerarquía Normativa</h2>
                    <ul>
                        <li><strong>Unión Europea:</strong> RGPD (Reglamento 2016/679). Norma suprema de aplicación directa.</li>
                        <li><strong>España:</strong> LOPDGDD 3/2018. Ley Orgánica que adapta el RGPD al ordenamiento español, añadiendo especificidades sobre investigación (Disp. Adicional 17ª).</li>
                        <li><strong>Específica Biomedicina:</strong> Ley 14/2007 de Investigación Biomédica. Regula los análisis genéticos, biobancos y el consentimiento informado específico.</li>
                    </ul>

                    <h2>2. El Consentimiento Informado</h2>
                    <p>Para el tratamiento de datos genéticos, el consentimiento debe cumplir cuatro requisitos del RGPD: <strong>Libre, Específico, Informado e Inequívoco</strong>. Además, debe ser <strong>Explícito</strong> al tratarse de datos sensibles.</p>
                    
                    <h3>El Debate del "Consentimiento Amplio"</h3>
                    <p>El Considerando 33 del RGPD permite flexibilizar la especificidad en investigación científica. Se permite pedir consentimiento para "áreas generales de investigación" (ej. "investigación en cáncer") en lugar de un proyecto único, siempre que se respeten estándares éticos.</p>
                `,
                controls: [
                    {id: "doc", label: "Documento Legal", options: ["Formulario Consentimiento RGPD", "Acuerdo Biobanco (Ley 14/2007)"]}
                ],
                generateCode: (val) => {
                    if(val.includes("RGPD")) return `
<span class="com">/* ESTRUCTURA DE DATOS PARA GESTIÓN DE CONSENTIMIENTO (JSON) */</span>
<span class="com">/* Basado en HL7 FHIR Consent Resource */</span>

{
  <span class="str">"resourceType"</span>: <span class="str">"Consent"</span>,
  <span class="str">"status"</span>: <span class="str">"active"</span>,
  <span class="str">"scope"</span>: {
    <span class="str">"coding"</span>: [{
      <span class="str">"system"</span>: <span class="str">"http://terminology.hl7.org/CodeSystem/consentscope"</span>,
      <span class="str">"code"</span>: <span class="str">"research"</span>,
      <span class="str">"display"</span>: <span class="str">"Research"</span>
    }]
  },
  <span class="str">"category"</span>: [{
    <span class="str">"coding"</span>: [{
      <span class="str">"system"</span>: <span class="str">"http://loinc.org"</span>,
      <span class="str">"code"</span>: <span class="str">"59284-0"</span>,
      <span class="str">"display"</span>: <span class="str">"Consent Document Genetic research"</span>
    }]
  }],
  <span class="str">"patient"</span>: { <span class="str">"reference"</span>: <span class="str">"Patient/example"</span> },
  <span class="str">"policy"</span>: [{
    <span class="str">"authority"</span>: <span class="str">"https://www.boe.es/eli/es/lo/2018/12/05/3"</span>,
    <span class="str">"uri"</span>: <span class="str">"urn:oid:LOPDGDD-Art-17"</span>
  }],
  <span class="str">"provision"</span>: {
    <span class="str">"type"</span>: <span class="str">"permit"</span>,
    <span class="str">"period"</span>: { <span class="str">"end"</span>: <span class="str">"2030-01-01"</span> },
    <span class="str">"purpose"</span>: [{
        <span class="str">"code"</span>: <span class="str">"CA-RES"</span>,
        <span class="str">"display"</span>: <span class="str">"Cancer Research Only"</span>
    }]
  }
}`;
                    return `
<span class="com">/* ESTRUCTURA REGISTRO BIOBANCO (Ley 14/2007) */</span>
<span class="com">/* Requiere aprobación del Comité de Ética (CEIC) */</span>

<span class="kwd">class</span> <span class="cls">BiobankEntry</span>:
    <span class="kwd">def</span> <span class="fn">register_sample</span>(<span class="var">self</span>, <span class="var">sample_data</span>):
        <span class="com"># Verificación obligatoria de requisitos legales</span>
        <span class="kwd">if</span> not <span class="var">sample_data</span>.has_ethics_approval:
            <span class="kwd">raise</span> <span class="cls">LegalError</span>(<span class="str">"Falta dictamen favorable del CEIC"</span>)
        
        <span class="kwd">if</span> not <span class="var">sample_data</span>.revocable_consent:
            <span class="kwd">raise</span> <span class="cls">LegalError</span>(<span class="str">"El paciente debe poder retirar la muestra"</span>)

        <span class="com"># Registro de cesión a terceros</span>
        <span class="var">self</span>.traceability_log.<span class="fn">append</span>({
            <span class="str">"sample_id"</span>: <span class="var">sample_data</span>.id,
            <span class="str">"collection_date"</span>: <span class="str">"2024-01-01"</span>,
            <span class="str">"storage_conditions"</span>: <span class="str">"-80C"</span>,
            <span class="str">"legal_custodian"</span>: <span class="str">"Biobanco Nacional de ADN"</span>
        })
        
        <span class="kwd">return</span> <span class="str">"Muestra registrada legalmente bajo Ley 14/2007"</span>`;
                }
            },
            {
                id: "t3",
                title: "Tema 3: Protocolos de Seguridad",
                icon: "fa-lock",
                content: `
                    <h1>Tema 3: Protocolos de Seguridad para Protección de Datos</h1>
                    <p>El RGPD (Art. 32) exige aplicar medidas técnicas y organizativas apropiadas para garantizar un nivel de seguridad adecuado al riesgo. En bioinformática, esto se traduce en estándares criptográficos y control de acceso.</p>

                    <h2>1. Cifrado (Encryption)</h2>
                    <ul>
                        <li><strong>En Reposo (At Rest):</strong> Los datos almacenados en discos duros deben estar cifrados. Estándares: AES-256 (Advanced Encryption Standard). Herramientas: LUKS (Linux), BitLocker (Windows).</li>
                        <li><strong>En Tránsito (In Transit):</strong> Los datos que viajan por la red deben ir por canales seguros. Protocolos: TLS 1.3, HTTPS, SSH, SFTP.</li>
                    </ul>

                    <h2>2. Control de Acceso (RBAC)</h2>
                    <p>El principio de "Mínimo Privilegio". Se utiliza RBAC (Role-Based Access Control) para asegurar que un bioinformático solo vea los ficheros BAM/VCF y no la historia clínica administrativa del paciente, y viceversa.</p>

                    <h2>3. Integridad y Trazabilidad</h2>
                    <p>Uso de funciones Hash (SHA-256) para verificar que los archivos de secuenciación masiva (que pueden ocupar TBs) no han sido alterados, corrompidos o manipulados.</p>
                `,
                controls: [
                    {id: "sec", label: "Protocolo Técnico", options: ["Cifrado Simétrico (AES-256)", "Verificación Integridad (SHA-256)", "Control Acceso (RBAC)"]}
                ],
                generateCode: (val) => {
                    if (val.includes("AES")) return `
<span class="com"># SCRIPT DE CIFRADO DE ARCHIVOS GENÓMICOS (Python + Cryptography)</span>
<span class="com"># Implementación de AES-256 en modo CBC con Padding</span>

<span class="kwd">import</span> os
<span class="kwd">from</span> cryptography.hazmat.primitives.ciphers <span class="kwd">import</span> Cipher, algorithms, modes
<span class="kwd">from</span> cryptography.hazmat.primitives <span class="kwd">import</span> padding

<span class="kwd">def</span> <span class="fn">encrypt_file</span>(<span class="var">input_file</span>, <span class="var">key</span>):
    <span class="com"># Generar Vector de Inicialización (IV) aleatorio (16 bytes)</span>
    <span class="var">iv</span> = os.urandom(16)
    
    <span class="var">cipher</span> = Cipher(algorithms.AES(<span class="var">key</span>), modes.CBC(<span class="var">iv</span>))
    <span class="var">encryptor</span> = <span class="var">cipher</span>.encryptor()

    <span class="kwd">with</span> <span class="fn">open</span>(<span class="var">input_file</span>, <span class="str">'rb'</span>) <span class="kwd">as</span> f:
        <span class="var">plaintext</span> = f.read()

    <span class="com"># Padding PKCS7 (AES requiere bloques de 128 bits)</span>
    <span class="var">padder</span> = padding.PKCS7(128).padder()
    <span class="var">padded_data</span> = <span class="var">padder</span>.update(<span class="var">plaintext</span>) + <span class="var">padder</span>.finalize()

    <span class="var">ciphertext</span> = <span class="var">encryptor</span>.update(<span class="var">padded_data</span>) + <span class="var">encryptor</span>.finalize()

    <span class="com"># Guardar IV + Ciphertext (El IV no es secreto, pero es necesario para descifrar)</span>
    <span class="kwd">return</span> <span class="var">iv</span> + <span class="var">ciphertext</span>`;

                    if (val.includes("SHA")) return `
<span class="com"># VERIFICACIÓN DE INTEGRIDAD (HASHING)</span>
<span class="com"># Crucial para detectar corrupción de datos en archivos FASTQ gigantes</span>

<span class="kwd">import</span> hashlib

<span class="kwd">def</span> <span class="fn">calculate_checksum</span>(<span class="var">file_path</span>):
    <span class="var">sha256_hash</span> = hashlib.sha256()
    
    <span class="com"># Leer archivo en bloques de 4KB para no saturar RAM</span>
    <span class="kwd">with</span> <span class="fn">open</span>(<span class="var">file_path</span>, <span class="str">"rb"</span>) <span class="kwd">as</span> f:
        <span class="kwd">for</span> <span class="var">byte_block</span> <span class="kwd">in</span> <span class="fn">iter</span>(<span class="kwd">lambda</span>: f.read(4096), b""):
            <span class="var">sha256_hash</span>.update(<span class="var">byte_block</span>)
            
    <span class="kwd">return</span> <span class="var">sha256_hash</span>.hexdigest()

<span class="com"># Uso:</span>
<span class="var">original_hash</span> = <span class="str">"a3c9b..."</span> <span class="com"># Valor enviado por el secuenciador</span>
<span class="var">current_hash</span> = <span class="fn">calculate_checksum</span>(<span class="str">"sample_R1.fastq"</span>)

<span class="kwd">if</span> <span class="var">original_hash</span> == <span class="var">current_hash</span>:
    <span class="fn">print</span>(<span class="str">"INTEGRIDAD OK: El archivo es idéntico bit a bit."</span>)
<span class="kwd">else</span>:
    <span class="fn">print</span>(<span class="str">"ERROR: Archivo corrupto o manipulado."</span>)`;

                    return `
<span class="com"># CONTROL DE ACCESO (RBAC) - ESTRUCTURA JSON</span>

{
  <span class="str">"roles"</span>: {
    <span class="str">"bioinformatician"</span>: {
      <span class="str">"can_read"</span>: [<span class="str">"*.fastq"</span>, <span class="str">"*.bam"</span>, <span class="str">"*.vcf"</span>],
      <span class="str">"can_write"</span>: [<span class="str">"/analysis/results"</span>],
      <span class="str">"denied"</span>: [<span class="str">"/clinical/patient_names.db"</span>] <span class="com"># Prohibido ver identidad</span>
    },
    <span class="str">"clinician"</span>: {
      <span class="str">"can_read"</span>: [<span class="str">"/clinical/*"</span>, <span class="str">"final_report.pdf"</span>],
      <span class="str">"can_write"</span>: [<span class="str">"/clinical/notes"</span>],
      <span class="str">"denied"</span>: [<span class="str">"/server/config"</span>, <span class="str">"raw_reads/"</span>]
    },
    <span class="str">"sysadmin"</span>: {
      <span class="str">"can_read"</span>: [<span class="str">"/system/logs"</span>],
      <span class="str">"can_write"</span>: [<span class="str">"/system/*"</span>],
      <span class="str">"denied"</span>: [<span class="str">"/clinical/*"</span>] <span class="com"># Admin no debe ver datos médicos</span>
    }
  }
}`;
                }
            },
            {
                id: "t4",
                title: "Tema 4: Transferencia Internacional",
                icon: "fa-globe",
                content: `
                    <h1>Tema 4: Transferencia Internacional de Datos (UE)</h1>
                    <p>El envío de datos genómicos a servidores fuera del Espacio Económico Europeo (EEE) constituye una Transferencia Internacional de Datos y está altamente restringido.</p>

                    <h2>1. Países con Decisión de Adecuación</h2>
                    <p>La Comisión Europea certifica que ciertos países ofrecen un nivel de protección equivalente al de la UE (ej. Japón, Israel, Reino Unido, Suiza). Con estos países, los datos fluyen libremente.</p>

                    <h2>2. Países sin Adecuación (ej. EE.UU., China, India)</h2>
                    <p>Aquí surgen los problemas legales. Tras la sentencia <strong>Schrems II</strong> del TJUE (2020), el acuerdo "Privacy Shield" con EE.UU. fue invalidado. Para enviar datos a nubes americanas (AWS, Google, Azure) se requieren garantías adicionales:</p>
                    <ul>
                        <li><strong>Cláusulas Contractuales Tipo (SCCs):</strong> Contratos modelo redactados por la Comisión Europea.</li>
                        <li><strong>Evaluación de Impacto de Transferencia (TIA):</strong> Análisis de riesgo legal del país destino.</li>
                        <li><strong>Medidas Suplementarias:</strong> Técnicas (Cifrado robusto donde el proveedor no tenga la clave) para evitar el acceso de agencias de inteligencia extranjeras (FISA 702 en EE.UU.).</li>
                    </ul>
                `,
                controls: [
                    {id: "dest", label: "Destino de Datos", options: ["Servidor Local UE", "Nube EE.UU. (AWS/GCP)", "Tercer País no Seguro"]}
                ],
                generateCode: (val) => {
                    if (val.includes("UE")) return `
<span class="com"># DESTINO: UNIÓN EUROPEA (Zona Segura)</span>
<span class="com"># No se requieren trámites adicionales de transferencia internacional.</span>

<span class="kwd">def</span> <span class="fn">check_compliance</span>(<span class="var">region</span>):
    <span class="kwd">if</span> <span class="var">region</span> <span class="kwd">in</span> [<span class="str">"eu-west-1"</span>, <span class="str">"eu-central-1"</span>, <span class="str">"es-madrid"</span>]:
        <span class="kwd">return</span> {
            <span class="str">"status"</span>: <span class="str">"OK"</span>,
            <span class="str">"mechanism"</span>: <span class="str">"Free Movement of Data (GDPR)"</span>,
            <span class="str">"risk_assessment"</span>: <span class="str">"Low"</span>
        }
    <span class="kwd">else</span>:
        <span class="kwd">raise</span> <span class="cls">Warning</span>(<span class="str">"Checking adequacy decision..."</span>)`;

                    if (val.includes("EE.UU.")) return `
<span class="com"># DESTINO: EE.UU. (Post-Schrems II)</span>
<span class="com"># Requiere SCCs + Medidas Suplementarias Técnicas</span>

<span class="kwd">class</span> <span class="cls">TransferRequest</span>:
    <span class="kwd">def</span> <span class="fn">__init__</span>(<span class="var">self</span>, <span class="var">provider</span>):
        <span class="var">self</span>.provider = <span class="var">provider</span> <span class="com"># ej: AWS us-east-1</span>
        <span class="var">self</span>.sccs_signed = <span class="kwd">True</span>
        <span class="var">self</span>.encryption_key_location = <span class="str">"On-Premise (Madrid)"</span>
    
    <span class="kwd">def</span> <span class="fn">validate</span>(<span class="var">self</span>):
        <span class="com"># Validación estricta: El proveedor no debe tener la clave de descifrado</span>
        <span class="kwd">if</span> <span class="var">self</span>.encryption_key_location == <span class="str">"Cloud Provider"</span>:
             <span class="kwd">raise</span> <span class="cls">GDPRViolation</span>(<span class="str">"DATA EXPOSED TO US SURVEILLANCE"</span>)
        
        <span class="kwd">return</span> <span class="str">"CONDITIONAL_PASS: Use BYOK (Bring Your Own Key)"</span>

<span class="com"># Nota: Se recomienda cifrar antes de subir a la nube.</span>`;

                    return `
<span class="com"># DESTINO: PAÍS SIN ACUERDO NI GARANTÍAS</span>
<span class="com"># Transferencia Prohibida salvo excepciones muy estrictas (Art. 49)</span>

<span class="kwd">def</span> <span class="fn">block_transfer</span>():
    <span class="fn">print</span>(<span class="str">"BLOQUEO: El país destino no ofrece garantías adecuadas."</span>)
    <span class="fn">print</span>(<span class="str">"No firmar contrato sin consultar DPO (Delegado Protección Datos)."</span>)
    <span class="kwd">return</span> <span class="kwd">False</span>`;
                }
            },
            {
                id: "t5",
                title: "Tema 5: Historia Clínica (HCE)",
                icon: "fa-notes-medical",
                content: `
                    <h1>Tema 5: Tratamiento de Datos en la Historia Clínica Electrónica</h1>
                    <p>La integración de datos genómicos en la Historia Clínica Electrónica (HCE) es el paso final para la medicina personalizada. Sin embargo, los sistemas hospitalarios tradicionales no están diseñados para almacenar terabytes de datos de secuenciación.</p>

                    <h2>1. Retos de Integración</h2>
                    <ul>
                        <li><strong>Volumen:</strong> Un archivo BAM puede pesar 100GB. La HCE solo suele guardar PDFs o textos cortos.</li>
                        <li><strong>Formato:</strong> Los bioinformáticos usan VCF/FASTQ; los médicos usan HL7/DICOM. Se necesitan conversores.</li>
                        <li><strong>Interoperabilidad Semántica:</strong> ¿Cómo codificar "variante patogénica en BRCA1"? Se usan ontologías estándar.</li>
                    </ul>

                    <h2>2. Estándares de Interoperabilidad</h2>
                    <ul>
                        <li><strong>HL7 FHIR (Fast Healthcare Interoperability Resources):</strong> El estándar moderno basado en API REST y JSON. Tiene recursos específicos como <em>MolecularSequence</em>.</li>
                        <li><strong>SNOMED CT:</strong> Terminología clínica estandarizada para codificar enfermedades y fenotipos.</li>
                        <li><strong>LOINC:</strong> Códigos universales para identificar pruebas de laboratorio y observaciones.</li>
                    </ul>
                `,
                controls: [
                    {id: "hce", label: "Estándar de Datos", options: ["HL7 FHIR (JSON)", "SNOMED CT (Codificación)"]}
                ],
                generateCode: (val) => {
                    if (val.includes("FHIR")) return `
<span class="com">/* RECURSO FHIR: INFORME DE GENÉTICA */</span>
<span class="com">/* Formato estándar para interoperabilidad hospitalaria */</span>

{
  <span class="str">"resourceType"</span>: <span class="str">"DiagnosticReport"</span>,
  <span class="str">"id"</span>: <span class="str">"genetics-example"</span>,
  <span class="str">"status"</span>: <span class="str">"final"</span>,
  <span class="str">"category"</span>: [{
    <span class="str">"coding"</span>: [{
      <span class="str">"system"</span>: <span class="str">"http://terminology.hl7.org/CodeSystem/v2-0074"</span>,
      <span class="str">"code"</span>: <span class="str">"GE"</span>,
      <span class="str">"display"</span>: <span class="str">"Genetics"</span>
    }]
  }],
  <span class="str">"code"</span>: {
    <span class="str">"coding"</span>: [{
      <span class="str">"system"</span>: <span class="str">"http://loinc.org"</span>,
      <span class="str">"code"</span>: <span class="str">"55232-3"</span>,
      <span class="str">"display"</span>: <span class="str">"Genetic analysis summary panel"</span>
    }]
  },
  <span class="str">"result"</span>: [
    {
      <span class="str">"reference"</span>: <span class="str">"Observation/variant-1"</span>,
      <span class="str">"display"</span>: <span class="str">"Pathogenic Variant BRCA1 c.68_69delAG"</span>
    }
  ],
  <span class="str">"presentedForm"</span>: [{
    <span class="str">"contentType"</span>: <span class="str">"application/pdf"</span>,
    <span class="str">"url"</span>: <span class="str">"http://hospital-server/reports/genetics/123.pdf"</span>
  }]
}`;
                    return `
<span class="com">/* CODIFICACIÓN SNOMED CT */</span>
<span class="com">/* Permite a las máquinas entender el significado clínico */</span>

<span class="str">"clinical_finding"</span>: {
    <span class="str">"conceptId"</span>: <span class="str">"416098002"</span>,
    <span class="str">"fsn"</span>: <span class="str">"Familial adenomatous polyposis (disorder)"</span>,
    <span class="str">"definition"</span>: <span class="str">"Autosomal dominant inherited disorder characterized by..."</span>
},

<span class="str">"genetic_finding"</span>: {
    <span class="str">"conceptId"</span>: <span class="str">"443967008"</span>,
    <span class="str">"fsn"</span>: <span class="str">"Mutation of APC gene (finding)"</span>
}

<span class="com">// Esto permite búsquedas semánticas: "Dame todos los pacientes con mutaciones en APC"</span>`;
                }
            }
        ];

        // =================================================================
        // DATOS DE TRABAJOS PRÁCTICOS (ACTIVIDADES 1 Y 2)
        // =================================================================

        const practicalModules = [
            {
                id: "act1",
                title: "Actividad 1: HULP & CNIO",
                icon: "fa-project-diagram",
                content: `
                    <h1>Trabajo Realizado 1: Colaboración Hospital La Paz - CNIO</h1>
                    <div class="highlight-box">
                        <strong>Objetivo:</strong> Diseñar un protocolo seguro y legal para la transferencia de datos genómicos de pacientes con cáncer de pulmón desde el entorno asistencial (HULP) al entorno de investigación (CNIO).
                    </div>

                    <h2>1. Retos Identificados</h2>
                    <ul>
                        <li>El Hospital La Paz debe custodiar la identidad del paciente (Historia Clínica).</li>
                        <li>El CNIO necesita datos genómicos de alta calidad pero no necesita saber quién es el paciente (Minimización de datos).</li>
                        <li>Riesgo de intercepción durante el envío de archivos VCF (datos sensibles).</li>
                    </ul>

                    <h2>2. Solución Implementada: Pseudonimización + SFTP</h2>
                    <p>Se implementó un sistema de doble capa:</p>
                    <ol>
                        <li><strong>Capa Lógica:</strong> Se generó un código de enlace (ej. <em>HULP-CNIO-RESP-001</em>). La tabla que une este código con el DNI del paciente reside en un servidor offline ("Air-gapped") dentro del hospital.</li>
                        <li><strong>Capa Física/Red:</strong> Se estableció un túnel SFTP (SSH File Transfer Protocol) con autenticación por llave pública. Se prohibió el uso de USBs o emails.</li>
                    </ol>

                    <h2>3. Garantía Legal</h2>
                    <p>Se firmó un contrato de encargado de tratamiento donde el CNIO se compromete a no intentar re-identificar a los pacientes. Se utilizaron algoritmos de cifrado asimétrico (RSA-4096) para el intercambio de claves de sesión.</p>
                `,
                controls: [],
                generateCode: () => `
<span class="com"># PROTOCOLO DE TRANSFERENCIA SEGURA (ACTIVIDAD 1)</span>
<span class="com"># Implementación en Python simulando el nodo del Hospital</span>

<span class="kwd">import</span> paramiko
<span class="kwd">import</span> os
<span class="kwd">from</span> cryptography.fernet <span class="kwd">import</span> Fernet

<span class="kwd">class</span> <span class="cls">SecureUploader</span>:
    <span class="kwd">def</span> <span class="fn">__init__</span>(<span class="var">self</span>, <span class="var">host</span>, <span class="var">user</span>, <span class="var">key_path</span>):
        <span class="var">self</span>.host = <span class="var">host</span>
        <span class="var">self</span>.user = <span class="var">user</span>
        <span class="var">self</span>.key = paramiko.RSAKey.from_private_key_file(<span class="var">key_path</span>)

    <span class="kwd">def</span> <span class="fn">encrypt_data</span>(<span class="var">self</span>, <span class="var">filepath</span>):
        <span class="com"># 1. Cifrado simétrico local antes del envío</span>
        <span class="var">key</span> = Fernet.generate_key()
        <span class="var">cipher</span> = Fernet(<span class="var">key</span>)
        
        <span class="kwd">with</span> <span class="fn">open</span>(<span class="var">filepath</span>, <span class="str">'rb'</span>) <span class="kwd">as</span> f:
            <span class="var">data</span> = f.read()
            
        <span class="kwd">return</span> <span class="var">cipher</span>.encrypt(<span class="var">data</span>), <span class="var">key</span>

    <span class="kwd">def</span> <span class="fn">upload</span>(<span class="var">self</span>, <span class="var">local_path</span>, <span class="var">remote_path</span>):
        <span class="com"># 2. Establecer túnel SSH seguro (SFTP)</span>
        <span class="var">transport</span> = paramiko.Transport((<span class="var">self</span>.host, 22))
        <span class="var">transport</span>.connect(username=<span class="var">self</span>.user, pkey=<span class="var">self</span>.key)
        
        <span class="var">sftp</span> = paramiko.SFTPClient.from_transport(<span class="var">transport</span>)
        
        <span class="com"># Subir archivo</span>
        <span class="fn">print</span>(f<span class="str">"Subiendo {local_path} a CNIO..."</span>)
        <span class="var">sftp</span>.put(<span class="var">local_path</span>, <span class="var">remote_path</span>)
        
        <span class="var">sftp</span>.close()
        <span class="var">transport</span>.close()
        <span class="fn">print</span>(<span class="str">"Transferencia completada exitosamente."</span>)

<span class="com"># Ejecución</span>
<span class="var">uploader</span> = <span class="cls">SecureUploader</span>(<span class="str">"sftp.cnio.es"</span>, <span class="str">"hulp_collab"</span>, <span class="str">"/keys/id_rsa"</span>)
<span class="var">uploader</span>.<span class="fn">upload</span>(<span class="str">"patient_data_enc.vcf"</span>, <span class="str">"/incoming/batch_01.vcf.enc"</span>)`
            },
            {
                id: "act2",
                title: "Actividad 2: LIMS & ISO 15189",
                icon: "fa-flask",
                content: `
                    <h1>Trabajo Realizado 2: Implementación de LIMS</h1>
                    <div class="highlight-box">
                        <strong>Objetivo:</strong> Digitalizar un laboratorio de diagnóstico genético mediante un sistema LIMS (Laboratory Information Management System) para cumplir con los estándares de calidad ISO 15189 y seguridad ISO 27001.
                    </div>

                    <h2>1. Reemplazo del Papel</h2>
                    <p>Se sustituyeron los cuadernos de laboratorio por un ELN (Electronic Lab Notebook) integrado. Esto asegura la trazabilidad completa: sabemos qué técnico realizó la extracción de ADN, qué lote de reactivos usó y en qué fecha/hora exacta.</p>

                    <h2>2. Control de Calidad (QC) Automatizado</h2>
                    <p>El sistema LIMS se configuró para impedir el avance de una muestra si no cumplía criterios de calidad. Ejemplo: Si la concentración de ADN es < 10 ng/uL, el sistema bloquea la preparación de librerías para NGS, evitando gastar reactivos caros en una muestra mala.</p>

                    <h2>3. Seguridad y Roles</h2>
                    <p>Se definió una matriz de accesos (RBAC):</p>
                    <ul>
                        <li><strong>Técnicos de Lab:</strong> Acceso a gestión de muestras y stocks. Sin acceso a informes clínicos finales.</li>
                        <li><strong>Bioinformáticos:</strong> Acceso a servidor de cálculo y archivos FASTQ. Sin acceso a datos de filiación (nombre/dirección).</li>
                        <li><strong>Director Médico:</strong> Acceso a informes finales para validación y firma.</li>
                    </ul>
                `,
                controls: [],
                generateCode: () => `
<span class="com">// CONFIGURACIÓN DEL WORKFLOW LIMS (JAVASCRIPT / NODE.JS)</span>
<span class="com">// Simulación de reglas de negocio para ISO 15189</span>

<span class="kwd">const</span> <span class="var">workflow_config</span> = {
    <span class="str">"stage_1_extraction"</span>: {
        <span class="str">"sop_id"</span>: <span class="str">"SOP-DNA-001"</span>,
        <span class="str">"required_fields"</span>: [<span class="str">"kit_lot_number"</span>, <span class="str">"extraction_date"</span>, <span class="str">"technician_id"</span>],
        <span class="str">"qc_rules"</span>: <span class="kwd">function</span>(<span class="var">sample</span>) {
            <span class="kwd">if</span> (<span class="var">sample</span>.concentration < 10.0) {
                <span class="kwd">return</span> { <span class="str">"status"</span>: <span class="str">"FAIL"</span>, <span class="str">"msg"</span>: <span class="str">"Low DNA concentration"</span> };
            }
            <span class="kwd">if</span> (<span class="var">sample</span>.ratio_260_280 < 1.8) {
                <span class="kwd">return</span> { <span class="str">"status"</span>: <span class="str">"FAIL"</span>, <span class="str">"msg"</span>: <span class="str">"Protein contamination detected"</span> };
            }
            <span class="kwd">return</span> { <span class="str">"status"</span>: <span class="str">"PASS"</span> };
        }
    },
    
    <span class="str">"stage_2_sequencing"</span>: {
        <span class="str">"platform"</span>: <span class="str">"Illumina NovaSeq"</span>,
        <span class="str">"input_requirement"</span>: <span class="str">"Library_QC_Pass"</span>,
        <span class="str">"audit_trail"</span>: <span class="kwd">true</span> <span class="com">// ISO 27001 Requirement</span>
    },

    <span class="str">"stage_3_reporting"</span>: {
        <span class="str">"format"</span>: <span class="str">"HL7_FHIR"</span>,
        <span class="str">"sign_off_role"</span>: <span class="str">"Medical_Director_Only"</span>
    }
};

<span class="com">// Función de validación de muestra</span>
<span class="kwd">function</span> <span class="fn">processSample</span>(<span class="var">sample</span>) {
    <span class="kwd">const</span> <span class="var">qc</span> = <span class="var">workflow_config</span>.stage_1_extraction.qc_rules(<span class="var">sample</span>);
    
    <span class="kwd">if</span> (<span class="var">qc</span>.status === <span class="str">"FAIL"</span>) {
        <span class="fn">logError</span>(<span class="str">"Sample "</span> + <span class="var">sample</span>.id + <span class="str">" rejected: "</span> + <span class="var">qc</span>.msg);
        <span class="fn">stopWorkflow</span>();
    } <span class="kwd">else</span> {
        <span class="fn">logAudit</span>(<span class="str">"Sample "</span> + <span class="var">sample</span>.id + <span class="str">" passed QC. Proceeding to Library Prep."</span>);
    }
}`
            }
        ];

        // =================================================================
        // LÓGICA DE INTERACCIÓN
        // =================================================================

        const theoryContainer = document.getElementById('theory-content');
        const codeEditor = document.getElementById('code-editor');
        const controlsArea = document.getElementById('controls-area');
        const tabTitle = document.getElementById('tab-name');
        const consoleOutput = document.getElementById('console-output');

        function renderSidebar() {
            // Render Theory
            const theoryMenu = document.getElementById('menu-theory');
            theoryModules.forEach(mod => {
                const item = document.createElement('div');
                item.className = 'nav-item';
                item.innerHTML = `<i class="fas ${mod.icon}"></i> ${mod.title.split(':')[0]}`;
                item.onclick = (e) => loadContent(mod, e.currentTarget);
                theoryMenu.appendChild(item);
            });

            // Render Practical
            const practicalMenu = document.getElementById('menu-practical');
            practicalModules.forEach(mod => {
                const item = document.createElement('div');
                item.className = 'nav-item';
                item.innerHTML = `<i class="fas ${mod.icon}"></i> ${mod.title.split(':')[0]}`;
                item.onclick = (e) => loadContent(mod, e.currentTarget);
                practicalMenu.appendChild(item);
            });
        }

        function loadContent(data, domElement) {
            // Update Active State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(domElement) domElement.classList.add('active');

            // Update Text Content
            theoryContainer.innerHTML = data.content;
            theoryContainer.scrollTop = 0;
            tabTitle.innerText = data.title;

            // Update Controls
            controlsArea.innerHTML = "";
            if (data.controls.length > 0) {
                data.controls.forEach(ctrl => {
                    const label = document.createElement('span');
                    label.innerText = ctrl.label + ": ";
                    label.style.fontSize = "0.8rem";
                    label.style.color = "#aaa";
                    
                    const select = document.createElement('select');
                    ctrl.options.forEach(opt => {
                        const o = document.createElement('option');
                        o.value = opt;
                        o.innerText = opt;
                        select.appendChild(o);
                    });

                    select.onchange = (e) => updateSimulator(data, e.target.value);
                    
                    controlsArea.appendChild(label);
                    controlsArea.appendChild(select);
                    
                    // Initial load
                    updateSimulator(data, ctrl.options[0]);
                });
            } else {
                controlsArea.innerHTML = "<span style='font-size:0.8rem; color:#666;'>Código estático de implementación (Caso Práctico)</span>";
                updateSimulator(data, null);
            }
        }

        function updateSimulator(data, val) {
            // Update Code
            codeEditor.innerHTML = data.generateCode(val);
            
            // Simulate Terminal
            const now = new Date().toLocaleTimeString();
            let log = `[${now}] SYSTEM: Loading module...\n`;
            
            if (val) {
                log += `[${now}] CONFIG: Applied setting "${val}"\n`;
                if(val.includes("Raw") || val.includes("En Claro")) log += `[${now}] WARN: GDPR non-compliance detected!\n`;
                if(val.includes("Hash") || val.includes("Pseudo")) log += `[${now}] INFO: Security protocol active.\n`;
            }
            
            log += `[${now}] COMPILER: Code generated successfully.\n> Ready for execution.`;
            consoleOutput.innerText = log;
        }

        // Init
        renderSidebar();
        // Load first module
        loadContent(theoryModules[0], document.querySelector('#menu-theory .nav-item'));

    </script>
</body>
</html>